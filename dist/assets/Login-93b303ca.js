import{_ as D,h as L,m as S,i as C,r as _,s as k,b as f,c as x,k as N,w as c,A as q,d as a,l as m,F as I,q as V,t as B,v as g,p as F,g as z,D as J}from"./index-215fdd4c.js";import{u as M}from"./store-6cfdb330.js";import{M as P}from"./Modal-d4d0d75a.js";/* empty css                                                              */const T=r=>(F("data-v-4699f73b"),r=r(),z(),r),$={id:"container"},O={id:"all"},R=T(()=>a("div",{id:"title"},"會員登入",-1)),j=J('<label for="email" data-v-4699f73b>信箱</label><input type="text" id="email" name="email" placeholder="請填完整信箱" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$" required data-v-4699f73b><label for="password" data-v-4699f73b>密碼</label><input type="password" id="password" name="password" placeholder="請填完整密碼" data-v-4699f73b><input id="Login-button" type="submit" value="登入" data-v-4699f73b>',5),A=[j],E={id:"other"},U={__name:"Login",setup(r){L();const i=S().query,v=C("config"),d=M(),s=_(""),o=_(!1),u=async()=>{const e=d.cartData;let t=JSON.parse(JSON.stringify(e));return console.log("%c vue拿到本地資料","color: yellow; font-weight: bold",t),t},w=async e=>{try{d.updateCartData(e),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await u())}catch(t){console.log("%c 更新本地資料失敗","color: white; font-weight: bold",t)}},h=async e=>{e.preventDefault();const t=new FormData(e.target),l=t.get("email"),p=t.get("password"),b=await u(),y={email:l,password:p,cartList:b.cartList};try{const n=await V(y,`${v.apiUrl}/login`);n.result?(await w(n.cartList),console.log("檢查是否有query::",i.fromPage),i.fromPage==="cart"?(s.value="登入成功 自動跳轉到購物車",o.value=!0,setTimeout(()=>{window.location.href="/shopCart"},2e3)):(s.value="登入成功 自動跳轉到會員中心",o.value=!0,setTimeout(()=>{window.location.href="/memberCenter"},2e3))):(error.value="登入失敗，請檢查信箱和密碼",s.value="登入失敗請重新登入",o.value=!0)}catch(n){s.value="登入失敗請重新登入",o.value=!0,console.error("處理登入時出現錯誤:",n)}};return(e,t)=>{const l=k("router-link");return f(),x(I,null,[o.value?(f(),N(P,{key:0,onClose:t[0]||(t[0]=p=>o.value=!1)},{default:c(()=>[a("p",null,B(s.value),1)]),_:1})):q("",!0),a("div",$,[a("div",O,[R,a("form",{onSubmit:h},A,32),a("div",E,[m(l,{class:"Login-small-button",to:"/register"},{default:c(()=>[g("註冊")]),_:1}),m(l,{class:"Login-small-button",to:"/forgetPassword"},{default:c(()=>[g("忘記密碼")]),_:1})])])])],64)}}},X=D(U,[["__scopeId","data-v-4699f73b"]]);export{X as default};
