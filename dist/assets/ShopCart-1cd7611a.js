import{_ as et,i as ot,k as ct,r as f,x as J,H as b,y as st,z as lt,o as rt,q as O,b as p,c as C,A as nt,w as E,B as it,d as o,h as ut,s as vt,t as h,F as w,e as q,u as dt,v as j,C as G,D as H,p as pt,g as ht}from"./index-acee48e4.js";import{u as _t}from"./store-bb461411.js";import{M as ft}from"./Modal-326d273c.js";/* empty css                                                              */const D=m=>(pt("data-v-23f002c9"),m=m(),ht(),m),Ct={id:"shopCart-container"},gt={id:"shopCart-all"},yt=D(()=>o("div",{id:"shopCart-title"},"購物車",-1)),Dt={id:"shopCart-main"},mt={id:"shopCartFrame"},St=["onClick"],Lt=["onClick"],wt=["src"],It={class:"shopCart-productDetail"},Pt=["onClick"],kt=D(()=>o("div",{class:"shopCart-gender"},"男",-1)),zt={class:"shopCart-select"},bt=["onUpdate:modelValue","onChange"],qt=["value"],$t=["onUpdate:modelValue","onChange"],Nt=["value"],Vt={class:"shopCart-price"},Mt={id:"shopCart-priceFrame"},Tt={id:"shopCart-box"},Ut=D(()=>o("div",{id:"shopCart-little"},"小計",-1)),At={class:"shopCart-priceLeft"},Bt=D(()=>o("div",{id:"shopCart-discount"},"折扣",-1)),Ft={class:"shopCart-priceLeft"},Jt=D(()=>o("div",{id:"shopCart-total"},"總計(不含運費)",-1)),Ot={class:"shopCart-priceLeft"},Et={__name:"ShopCart",setup(m){const I=ot("config"),P=_t(),$=ct(),k=f(!1),N=f(""),r=f({cartList:[]}),l=f({cartData:[]}),S=f(0),u=J(()=>X()),v=f("無折扣"),V=J(()=>Y()),_=b(new Array(l.value.cartData.length).fill(null)),n=b(new Array(l.value.cartData.length).fill(null)),g=b(new Array(l.value.cartData.length).fill([])),M=f(!1),T=async()=>{const t=P.cartData;let a=JSON.parse(JSON.stringify(t));return console.log("%c vue拿到本地資料","color: yellow; font-weight: bold",a),a},y=async t=>{try{P.updateCartData(t),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await T())}catch{console.log("更新本地資料失敗")}},Q=async t=>{try{P.updatePriceData(t)}catch{console.log("更新本地資料失敗")}};function U(t,a){const e=l.value.cartData[t],s=_[t],c=e.inventory.find(d=>d.productSize===s);if(c){const d=c.inventory;g[t]=new Array(d).fill().map((L,i)=>i+1),a||(n[t]=1)}else g[t]=[],n[t]=null}const R=async t=>{const a=l.value.cartData[t],e=_[t],s=n[t],c=a.inventory.find(i=>i.productSize===e).productSizeID,d=r.value.cartList.findIndex(i=>i.productSizeID===c),L=a.inventory.find(i=>i.productSizeID===c).inventory;if(d!==-1){const i=r.value.cartList[d],z=i.quantity+s;z<=L?(i.quantity=z,n[d]=z):(i.quantity=L,n[d]=L),r.value.cartList.splice(t,1),_.splice(t,1),n.splice(t,1),g.splice(t,1),l.value.cartData=r.value.cartList.map(B=>{const F=l.value.cartData.find(at=>at.productSizeID===B.productSizeID);return console.log(F,"搜尋到的資料更改=-=-=-=-=-=-="),{...F,quantity:B.quantity}})}else U(t,!1),r.value.cartList.splice(t,1,{productSizeID:c,quantity:s,productSize:e}),l.value.cartData[t].productSizeID=c,l.value.cartData[t].quantity=s,l.value.cartData[t].productSize=e,await y(r.value.cartList)},K=async(t,a)=>{r.value.cartList[t].quantity=a;const e=l.value.cartData[t];e.quantity=a,await y(r.value.cartList)};function A(t){$.push({name:"Product",params:{id:t},props:{id:t}})}function W(t){const a=l.value.cartData[t],e=n[t];return a.price*e}function X(){return l.value.cartData.reduce((t,a,e)=>{const s=n[e];return t+a.price*s},0)}function Y(){if(u.value>=1e4&&S.value===0&&(v.value="9折"),S.value===1&&(v.value="8折"),u.value<1e4&&S.value===0&&(v.value="無折扣"),v.value==="無折扣")return u.value;if(v.value==="9折")return u.value*.9;if(v.value==="8折")return u.value*.8}const Z=async t=>{r.value.cartList.splice(t,1),l.value.cartData.splice(t,1),_.splice(t,1),n.splice(t,1),g.splice(t,1),y(r.value.cartList),M.value===!0&&await O(r.value,`${I.apiUrl}/updateCart`)},x=async()=>{let t={subTotal:u.value,discount:v.value,totalPrice:V.value};Q(t),y(r.value.cartList),$.push("/shopCartNext")},tt=async()=>{if(u.value!==0)return x();N.value="購物車沒有商品",k.value=!0,console.log("購物車沒有商品")};return st(async()=>{lt().then(t=>{let a=t.isLogin;M.value=a,console.log("%c 登入狀況::","color: red; font-weight: bold",a)}).catch(t=>{console.log("重新讀取")})}),rt(async()=>{let t=await T();const a=await O(t,`${I.apiUrl}/cart`);l.value={cartData:a.cartData},r.value={cartList:a.cartList},a.level&&(S.value=a.level),console.log("%c cartData::ref已寫入","color: green; font-weight: bold",l.value),console.log("%c cartList::ref已寫入","color: green; font-weight: bold",r.value),console.log("%c memberLevel::ref已寫入","color: green; font-weight: bold",a.level),y(r.value.cartList),l.value.cartData.forEach((e,s)=>{_[s]=e.inventory[0].productSize,n[s]=e.quantity>e.inventory[0].inventory?e.inventory[0].inventory:e.quantity,U(s,!0)})}),(t,a)=>(p(),C(w,null,[k.value?(p(),nt(ft,{key:0,onClose:a[0]||(a[0]=e=>k.value=!1)},{default:E(()=>[o("p",null,h(N.value),1)]),_:1})):it("",!0),o("div",Ct,[o("div",gt,[yt,o("div",Dt,[o("div",mt,[ut(vt,{name:"list",tag:"ul"},{default:E(()=>[(p(!0),C(w,null,q(l.value.cartData,(e,s)=>(p(),C("div",{key:s,class:"shopCart-product"},[o("div",{class:"shopCart-delete",onClick:c=>Z(s)},"x",8,St),o("div",{onClick:c=>A(e.productID),class:"shopCart-productPic"},[o("img",{src:`${dt(I).apiUrl}/`+e.imgSrc},null,8,wt)],8,Lt),o("div",It,[o("div",{onClick:c=>A(e.productID),class:"shopCart-productName"},h(e.productName),9,Pt),kt,o("div",zt,[j(" 尺寸 "),G(o("select",{class:"shopCart-size","onUpdate:modelValue":c=>_[s]=c,onChange:c=>R(s)},[(p(!0),C(w,null,q(e.inventory,c=>(p(),C("option",{key:c.productSizeID,value:c.productSize},h(c.productSize),9,qt))),128))],40,bt),[[H,_[s]]]),j(" 數量 "),G(o("select",{class:"shopCart-count","onUpdate:modelValue":c=>n[s]=c,onChange:c=>K(s,n[s])},[(p(!0),C(w,null,q(g[s],c=>(p(),C("option",{key:c,value:c},h(c),9,Nt))),128))],40,$t),[[H,n[s]]])])]),o("div",Vt,h(W(s))+"$",1)]))),128))]),_:1})]),o("div",Mt,[o("div",Tt,[Ut,o("div",At,h(u.value),1),Bt,o("div",Ft,h(v.value),1),Jt,o("div",Ot,h(V.value),1)]),o("button",{id:"shopCart-next",onClick:a[1]||(a[1]=e=>tt())},"下一步")])])])])],64))}},Rt=et(Et,[["__scopeId","data-v-23f002c9"]]);export{Rt as default};
