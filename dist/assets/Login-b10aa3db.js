import{_ as D,h as L,m as S,i as C,r as _,s as k,b as f,c as x,k as N,w as c,A as q,d as a,l as m,F as I,q as V,t as B,v as g,p as F,g as z,D as J}from"./index-a6ac2222.js";import{u as M}from"./store-467a2af1.js";import{M as P}from"./Modal-966c6659.js";/* empty css                                                              */const T=r=>(F("data-v-72fe4e34"),r=r(),z(),r),$={id:"container"},O={id:"all"},R=T(()=>a("div",{id:"title"},"會員登入",-1)),j=J('<label for="email" data-v-72fe4e34>信箱</label><input type="text" id="email" name="email" placeholder="請填完整信箱" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$" required data-v-72fe4e34><label for="password" data-v-72fe4e34>密碼</label><input type="password" id="password" name="password" placeholder="請填完整密碼" data-v-72fe4e34><input id="Login-button" type="submit" value="登入" data-v-72fe4e34>',5),A=[j],E={id:"other"},U={__name:"Login",setup(r){L();const i=S().query,v=C("config"),d=M(),s=_(""),o=_(!1),u=async()=>{const t=d.cartData;let e=JSON.parse(JSON.stringify(t));return console.log("%c vue拿到本地資料","color: yellow; font-weight: bold",e),e},w=async t=>{try{d.updateCartData(t),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await u())}catch(e){console.log("%c 更新本地資料失敗","color: white; font-weight: bold",e)}},h=async t=>{t.preventDefault();const e=new FormData(t.target),l=e.get("email"),p=e.get("password"),y=await u(),b={email:l,password:p,cartList:y.cartList};try{const n=await V(b,`${v.apiUrl}/login`);n.result?(await w(n.cartList),console.log("檢查是否有query::",i.fromPage),i.fromPage==="cart"?(s.value="登入成功 自動跳轉到購物車",o.value=!0,setTimeout(()=>{window.location.href="/shopCart"},2e3)):(s.value="登入成功 自動跳轉到會員中心",o.value=!0,setTimeout(()=>{window.location.href="/memberCenter"},2e3))):(error.value="登入失敗，請檢查信箱和密碼",s.value="登入失敗請重新登入",o.value=!0)}catch(n){s.value="登入失敗請重新登入",o.value=!0,console.error("處理登入時出現錯誤:",n)}};return(t,e)=>{const l=k("router-link");return f(),x(I,null,[o.value?(f(),N(P,{key:0,onClose:e[0]||(e[0]=p=>o.value=!1)},{default:c(()=>[a("p",null,B(s.value),1)]),_:1})):q("",!0),a("div",$,[a("div",O,[R,a("form",{onSubmit:h},A,32),a("div",E,[m(l,{class:"Login-small-button",to:"/register"},{default:c(()=>[g("註冊")]),_:1}),m(l,{class:"Login-small-button",to:"/forgetPassword"},{default:c(()=>[g("忘記密碼")]),_:1})])])])],64)}}},X=D(U,[["__scopeId","data-v-72fe4e34"]]);export{X as default};
