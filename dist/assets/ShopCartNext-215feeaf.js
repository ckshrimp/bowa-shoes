import{_ as Y,i as Z,h as ee,r as s,x as U,y as te,z as oe,o as ae,j as le,b as r,c as n,l as se,w as re,T as ne,k as ie,d as t,A as p,B as d,E as m,I as ue,v as de,C as $,F as R,e as z,t as h,q as E,p as ce,g as pe}from"./index-a6ac2222.js";import{u as ve}from"./store-467a2af1.js";/* empty css                                                              */import{L as he}from"./Loading-f672881b.js";const l=C=>(ce("data-v-9a587db1"),C=C(),pe(),C),_e={id:"shopCartNext-container"},me={key:1,id:"shopCartNext-all"},ye=l(()=>t("div",{id:"shopCartNext-title"},"訂單資料",-1)),fe={id:"shopCartNext-main"},ge={key:0,id:"shopCartNext-DetailFrame"},xe={key:0},be=l(()=>t("label",null,"尚未登入? ",-1)),Ce=l(()=>t("div",null,"*為必填資料",-1)),Ne={key:0,for:"email"},we=l(()=>t("br",null,null,-1)),ke=l(()=>t("label",{for:"name"},"收件人姓名 *",-1)),De=l(()=>t("br",null,null,-1)),Le=l(()=>t("label",{for:"phoneNumber"},"收件人手機 *",-1)),Ie=l(()=>t("br",null,null,-1)),Me=l(()=>t("label",{for:"address"},"運送地址 *",-1)),Se={key:2,for:"birthday"},Ve={key:4,for:"agree"},Fe=l(()=>t("br",null,null,-1)),qe=l(()=>t("br",null,null,-1)),Ue=l(()=>t("label",{for:"payment"},"付款方式 *",-1)),Te=l(()=>t("option",{value:"尚未選擇付款方式"},"尚未選擇付款方式",-1)),Pe=["value"],Be=l(()=>t("label",{for:"delivery"},"運送方式 *",-1)),Oe=l(()=>t("option",{value:"尚未選擇運送方式"},"尚未選擇運送方式",-1)),$e=["value"],Re=l(()=>t("label",{for:"remark"},"備註",-1)),ze={id:"shopCartNext-priceFrame"},Ee={id:"shopCartNext-box"},Je=l(()=>t("div",{id:"shopCartNext-little"},"小計",-1)),je={class:"shopCartNext-priceLeft"},Ae=l(()=>t("div",{id:"shopCartNext-discount"},"折扣",-1)),We={class:"shopCartNext-priceLeft"},Ge=l(()=>t("div",{id:"shopCartNext-delivery"},"運送方式",-1)),He={class:"shopCartNext-priceLeft"},Ke=l(()=>t("div",{id:"shopCartNext-shipping"},"運費",-1)),Qe={class:"shopCartNext-priceLeft"},Xe=l(()=>t("div",{id:"shopCartNext-total"},"應付總金額",-1)),Ye={class:"shopCartNext-priceLeft"},Ze={__name:"ShopCartNext",setup(C){const I=Z("config"),M=ve(),N=ee(),i=s(!1),S=s(!0),w=s(""),y=s(""),k=s("0000/00/00"),f=s(""),g=s(""),V=s(""),F=s(!1),T=s([]),q=s([]),P=s("尚未選擇運送方式"),_=s("尚未選擇付款方式"),v=s("尚未選擇運送方式"),x=s(0),c=s("無折扣"),D=s(),B=U(()=>G()),O=U(()=>H()),L=async()=>{const a=M.cartData;let e=JSON.parse(JSON.stringify(a));return console.log("%c vue拿到本地資料","color: yellow; font-weight: bold",e),e},J=async a=>{try{M.updateCartData(a),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await L())}catch{console.log("%c更新本地資料失敗","color: white; font-weight: bold")}},j=async a=>{try{M.updatePriceData(a),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await L())}catch{console.log("%c 更新本地資料失敗","color: white; font-weight: bold")}},A=async a=>{N.push({name:"Login",query:{fromPage:"cart"}})},W=a=>{for(let e=a.length-1;e>=0;e--)if(B.value>=a[e].consumeTotal)return a[e].shippingCost};function G(){if(console.log("------------計算總金額------------"),c.value==="無折扣")return console.log("無折扣"),x.value;if(c.value==="9折")return console.log("9折"),x.value*.9;if(c.value==="8折")return console.log("8折"),x.value*.8}const H=()=>B.value+D.value,K=U(()=>i.value===!0?(console.log("進入已登入判斷"),y.value&&f.value&&g.value&&v.value!=="尚未選擇運送方式"&&_.value!=="尚未選擇付款方式"):(console.log("進入未登入判斷"),w.value&&y.value&&f.value&&k.value!=="0000/00/00"&&g.value&&v.value!=="尚未選擇運送方式"&&F.value===!0&&_.value!=="尚未選擇付款方式")),Q=async a=>{a.preventDefault();let e=await L(),o;c.value==="9折"&&(o=.9),c.value==="8折"&&(o=.8),c.value==="無折扣"&&(o=1);let b;const u={cartList:e.cartList,recipientInfo:{recipientName:y.value,recipientAddress:g.value,recipientPhoneNumber:f.value},paymentMethodID:_.value,deliveryMethodID:v.value,discount:o,shippingCost:parseFloat(D.value),totalPrice:O.value,remark:V.value};return i.value?(console.log("%c 送出的訂單資料","color: white; font-weight: bold",u),b=await E(u,`${I.apiUrl}/createOrder`)):(u.recipientInfo.recipientBirthday=k.value,u.recipientInfo.recipientEMail=w.value,console.log("%c 送出的訂單資料","color: white; font-weight: bold",u),b=await E(u,`${I.apiUrl}/createOrder`)),b.orderID!==!1?(await J([]),await j({}),_.value===2?(console.log("%c現金付款成功","color: green; font-weight: bold"),N.push({name:"Redirect",query:{pageFrom:"recipient",status:"true",payment:"現金"}})):(console.log("%c前往信用卡付款","color: green; font-weight: bold"),N.push({name:"Redirect",query:{pageFrom:"recipient",status:"true",payment:"信用卡"}}))):(console.log("%c訂單成立失敗","color: green; font-weight: bold"),N.push({name:"Redirect",query:{pageFrom:"recipient",status:"false"}}))},X=()=>{let a=q.value.find(e=>e.deliveryMethodID===v.value).methodDetail;P.value=a};return te(async()=>{oe().then(a=>{let e=a.isLogin;i.value=e,console.log("登入狀況::",e)}).catch(a=>{console.log("重新讀取")})}),ae(async()=>{let{price:a}=await L(),{paymentMethod:e,deliveryMethod:o,shippingCostCondition:b}=await le(`${I.apiUrl}/orderFormOption`);x.value=a.subTotal,c.value=a.discount,T.value=e,q.value=o;let u=W(b);console.log("計算出運費",u),D.value=u,setTimeout(()=>{S.value=!1},1500)}),(a,e)=>(r(),n("div",_e,[se(ne,{name:"fade",mode:"out-in"},{default:re(()=>[S.value===!0?(r(),ie(he,{key:0})):(r(),n("div",me,[ye,t("div",fe,[S.value?p("",!0):(r(),n("div",ge,[i.value===!1?(r(),n("div",xe,[be,t("label",{onClick:A},"點擊登入")])):p("",!0),Ce,t("div",null,[i.value===!1?(r(),n("label",Ne,"信箱 *")):p("",!0),i.value===!1?d((r(),n("input",{key:1,type:"text",id:"shopCartNext-email",name:"email","onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),placeholder:"請填寫完整信箱",pattern:"[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$",required:""},null,512)),[[m,w.value]]):p("",!0),we,ke,d(t("input",{type:"text",id:"shopCartNext-buyerName",name:"name","onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o),placeholder:"請填寫收件人姓名",required:""},null,512),[[m,y.value]]),De,Le,d(t("input",{type:"text",id:"shopCartNext-phoneNumber",name:"phoneNumber","onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),placeholder:"請填寫手機",pattern:"^09\\d{8}$",required:""},null,512),[[m,f.value]]),Ie,Me,d(t("input",{type:"text",id:"shopCartNext-address",name:"address","onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),placeholder:"請填寫運送地址",required:""},null,512),[[m,g.value]]),i.value===!1?(r(),n("label",Se,"生日 *")):p("",!0),i.value===!1?d((r(),n("input",{key:3,type:"date",id:"shopCartNext-birthday",name:"birthday","onUpdate:modelValue":e[4]||(e[4]=o=>k.value=o)},null,512)),[[m,k.value]]):p("",!0),i.value===!1?(r(),n("label",Ve,[d(t("input",{type:"radio",id:"shopCartNext-agree",name:"agree","onUpdate:modelValue":e[5]||(e[5]=o=>F.value=o),value:!0,required:""},null,512),[[ue,F.value]]),de(" 加入會員並同意會員規範,預設登入密碼為手機號碼 ")])):p("",!0),Fe,qe,Ue,d(t("select",{id:"shopCartNext-payment",name:"payment","onUpdate:modelValue":e[6]||(e[6]=o=>_.value=o),required:""},[Te,(r(!0),n(R,null,z(T.value,o=>(r(),n("option",{key:o.paymentMethodID,value:o.paymentMethodID},h(o.paymentMethod),9,Pe))),128))],512),[[$,_.value]]),Be,d(t("select",{id:"shopCartNext-delivery",name:"delivery","onUpdate:modelValue":e[7]||(e[7]=o=>v.value=o),onChange:e[8]||(e[8]=o=>X(v.value)),required:""},[Oe,(r(!0),n(R,null,z(q.value,o=>(r(),n("option",{key:o.deliveryMethodID,value:o.deliveryMethodID},h(o.deliveryMethod),9,$e))),128))],544),[[$,v.value]]),Re,d(t("input",{type:"text",id:"shopCartNext-remark",name:"remark","onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o),placeholder:"備註"},null,512),[[m,V.value]])])])),t("div",ze,[t("div",Ee,[Je,t("div",je,h(x.value),1),Ae,t("div",We,h(c.value),1),Ge,t("div",He,h(P.value),1),Ke,t("div",Qe,h(D.value),1),Xe,t("div",Ye,h(O.value),1)]),K.value?(r(),n("button",{key:0,id:"shopCartNext-next",onClick:Q},"送出訂單")):p("",!0)])])]))]),_:1})]))}},lt=Y(Ze,[["__scopeId","data-v-9a587db1"]]);export{lt as default};
