import{h as q,i as j,r as i,x as E,y as R,z as H,o as K,q as C,b as s,c as l,k as b,w as z,A as u,d as a,l as Q,T as W,F as f,t as g,u as I,e as S,f as P,B as X,C as Y}from"./index-a6ac2222.js";import{u as Z}from"./store-467a2af1.js";import{M as ee}from"./Modal-966c6659.js";import{L as te}from"./Loading-f672881b.js";/* empty css                                                              */const oe={class:"product-container"},ae={key:1,id:"all"},se={id:"leftArea"},le={key:0,id:"productPic"},re={id:"preview"},ce=["src"],ie={id:"selectList"},ue=["onClick"],ne=["src"],de={id:"rightArea"},ve={key:0,id:"productDetail"},_e={key:1,id:"productDetail"},pe={class:"group"},me={id:"name"},ge={id:"Price"},ye={class:"group"},he=a("div",{class:"title"},"顏色",-1),fe={id:"colorGroup"},ke=["onClick"],Se=["src"],De={class:"group"},Ce=a("div",{class:"title"},"尺寸",-1),Ie={id:"sizeGroup"},Le=["onClick"],$e={key:0,class:"group"},we=a("div",{class:"title"},"數量",-1),be={id:"countGroup"},ze={key:1,id:"buttonGroup"},Pe={class:"productDes"},Te={__name:"Product",props:["id"],setup(N){const B=N,F=q(),v=j("config"),L=Z(),_=i(!0),n=i([]),r=i(n[0]),c=i(null),d=i(1),k=i(""),p=i([]),y=i(""),m=i(!1),D=i(null),$=i(!1),U=async t=>{try{L.updateCartData(t);return}catch{console.log("更新本地資料失敗")}},M=async()=>{const t=L.cartData;let o=JSON.parse(JSON.stringify(t));return console.log(o,"拿到本地資料"),o},T=t=>{console.log(t,"已選擇"),k.value=t.imgSrc},x=(t,o)=>{r.value=n.value.find(e=>e.style===t),c.value=null,d.value=1,console.log(p.value),w(o.imgSrc),k.value=p.value[0].imgSrc},w=t=>{p.value=t.map(o=>({imgSrc:`/${o.imgSrc}`}))},A=t=>{t.inventory!==0&&(c.value=t)},G=E(()=>{if(!c.value)return[];const t=r.value.inventory.find(o=>o.productSizeID===c.value.productSizeID);return Array.from({length:t.inventory+1},(o,e)=>e)}),V=async()=>{if(r.value.productID&&r.value.productName&&c.value&&d.value){let t={productSizeID:c.value.productSizeID};console.log("加入收藏：",t);try{await C(t,`${v.apiUrl}/addFavor`)!==!1?(y.value="加入收藏成功",m.value=!0):(y.value="加入收藏失敗",m.value=!0)}catch{console.error("加入收藏失敗")}}},J=async()=>{let t,o,e;try{o=await M(),o.cartList||(o.cartList=[])}catch{console.error("讀取本地資料失敗")}r.value.productID&&r.value.productName&&c.value&&d.value&&(t={productData:{productSizeID:c.value.productSizeID,quantity:parseInt(d.value)},cartList:o.cartList});try{e=await C(t,`${v.apiUrl}/addProductToCart`),e.result!==!1?(y.value="加入購物車成功",m.value=!0):(y.value="加入購物車失敗",m.value=!0)}catch{console.error("加入購物車失敗")}try{await U(e.cartList)}catch{console.error("更新本地失敗")}};R(async()=>{H().then(t=>{let o=t.isLogin;$.value=o,console.log("%c 登入狀況::","color: red; font-weight: bold",o)}).catch(t=>{console.log("重新讀取")})}),K(async()=>{console.log("傳遞的id:",D.value);let t={productID:D.value},o=await C(t,`${v.apiUrl}/product`);n.value=o,r.value=n.value[0],k.value=n.value[0].imgSrc[0].imgSrc,p.value=n.value[0].imgSrc,w(p.value),setTimeout(()=>{_.value=!1},1e3)}),D.value=B.id;const O=()=>{F.back()};return(t,o)=>(s(),l(f,null,[m.value?(s(),b(ee,{key:0,onClose:o[0]||(o[0]=e=>m.value=!1)},{default:z(()=>[a("p",null,g(y.value),1)]),_:1})):u("",!0),a("div",oe,[_.value===!1?(s(),l("button",{key:0,class:"product-back-button",onClick:O},"回上一頁")):u("",!0),Q(W,{name:"fade",mode:"out-in"},{default:z(()=>[_.value===!0?(s(),b(te,{key:0})):(s(),l("div",ae,[a("div",se,[_.value?u("",!0):(s(),l("div",le,[a("div",re,[a("img",{src:`${I(v).picUrl}/${k.value}`},null,8,ce)]),a("div",ie,[(s(!0),l(f,null,S(p.value,e=>(s(),l("div",{key:e.imgSrc,class:"smallPic",onClick:h=>T(e)},[a("img",{src:`${I(v).picUrl}/${e.imgSrc}`},null,8,ne)],8,ue))),128))])]))]),a("div",de,[_.value?(s(),l("div",ve)):u("",!0),_.value?u("",!0):(s(),l("div",_e,[a("div",pe,[a("div",me,g(r.value.productName),1),a("div",ge,"$"+g(r.value.price),1)]),a("div",ye,[he,a("div",fe,[(s(!0),l(f,null,S(n.value,e=>(s(),l("div",{key:e.style,class:P(["color",{active:e.style===r.value.style}]),onClick:h=>x(e.style,e)},[a("img",{src:` ${I(v).picUrl}/${e.imgSrc[0].imgSrc}`},null,8,Se)],10,ke))),128))])]),a("div",De,[Ce,a("div",Ie,[(s(!0),l(f,null,S(r.value.inventory,e=>(s(),l("div",{key:e.productSizeID,class:P(["size","smallButton",{outOfStock:e.inventory===0,active:e===c.value}]),onClick:h=>A(e)},g(e.productSize),11,Le))),128))])]),c.value?(s(),l("div",$e,[we,a("div",be,[X(a("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e)},[(s(!0),l(f,null,S(G.value,e=>(s(),l("option",{key:e},g(e),1))),128))],512),[[Y,d.value]])])])):u("",!0),d.value>0&&c.value!==null?(s(),l("div",ze,[$.value?(s(),l("button",{key:0,class:"add",onClick:V},"加入收藏")):u("",!0),a("button",{class:"add",onClick:J},"加入購物車")])):u("",!0),a("div",Pe,g(r.value.remark),1)]))])]))]),_:1})])],64))}};export{Te as default};
