import{i as O,r as i,x as q,y as j,z as E,o as H,q as C,b as s,c as l,A as K,w as I,B as n,d as a,h as P,T as N,F as f,t as h,u as L,e as k,f as B,C as Q,D as R}from"./index-acee48e4.js";import{u as W}from"./store-bb461411.js";import{M as X}from"./Modal-326d273c.js";/* empty css                                                              */const Y={class:"container"},Z={key:0,class:"loading"},ee=a("div",{class:"la-fire la-dark la-3x"},[a("div"),a("div"),a("div")],-1),te=[ee],oe={key:0,id:"all"},ae={id:"leftArea"},se={key:0,id:"productPic"},le={id:"preview"},re=["src"],ce={id:"selectList"},ie=["onClick"],ne=["src"],ue={id:"rightArea"},de={key:0,id:"productDetail"},ve={key:1,id:"productDetail"},_e={class:"group"},pe={id:"name"},ge={id:"Price"},he={class:"group"},me=a("div",{class:"title"},"顏色",-1),ye={id:"colorGroup"},fe=["onClick"],Se=["src"],ke={class:"group"},De=a("div",{class:"title"},"尺寸",-1),Ce={id:"sizeGroup"},Ie=["onClick"],Le={key:0,class:"group"},$e=a("div",{class:"title"},"數量",-1),we={id:"countGroup"},ze={key:1,id:"buttonGroup"},Pe={class:"productDes"},be={__name:"Product",props:["id"],setup(F){const U=F,v=O("config"),$=W(),_=i(!0),u=i([]),r=i(u[0]),c=i(null),d=i(1),S=i(""),p=i([]),m=i(""),g=i(!1),D=i(null),w=i(!1),b=async t=>{try{$.updateCartData(t);return}catch{console.log("更新本地資料失敗")}},x=async()=>{const t=$.cartData;let o=JSON.parse(JSON.stringify(t));return console.log(o,"拿到本地資料"),o},M=t=>{console.log(t,"已選擇"),S.value=t.imgSrc},A=(t,o)=>{r.value=u.value.find(e=>e.style===t),c.value=null,d.value=1,console.log(p.value),z(o.imgSrc),S.value=p.value[0].imgSrc},z=t=>{p.value=t.map(o=>({imgSrc:`/${o.imgSrc}`}))},T=t=>{t.inventory!==0&&(c.value=t)},G=q(()=>{if(!c.value)return[];const t=r.value.inventory.find(o=>o.productSizeID===c.value.productSizeID);return Array.from({length:t.inventory+1},(o,e)=>e)}),V=async()=>{if(r.value.productID&&r.value.productName&&c.value&&d.value){let t={productSizeID:c.value.productSizeID};console.log("加入收藏：",t);try{await C(t,`${v.apiUrl}/addFavor`)!==!1?(m.value="加入收藏成功",g.value=!0):(m.value="加入收藏失敗",g.value=!0)}catch{console.error("加入收藏失敗")}}},J=async()=>{let t,o,e;try{o=await x(),o.cartList||(o.cartList=[])}catch{console.error("讀取本地資料失敗")}r.value.productID&&r.value.productName&&c.value&&d.value&&(t={productData:{productSizeID:c.value.productSizeID,quantity:d.value},cartList:o.cartList});try{e=await C(t,`${v.apiUrl}/addProductToCart`),e.result!==!1?(m.value="加入購物車成功",g.value=!0):(m.value="加入購物車失敗",g.value=!0)}catch{console.error("加入購物車失敗")}try{await b(e.cartList)}catch{console.error("更新本地失敗")}};return j(async()=>{E().then(t=>{let o=t.isLogin;w.value=o,console.log("%c 登入狀況::","color: red; font-weight: bold",o)}).catch(t=>{console.log("重新讀取")})}),H(async()=>{console.log("傳遞的id:",D.value);let t={productID:D.value},o=await C(t,`${v.apiUrl}/product`);u.value=o,r.value=u.value[0],S.value=u.value[0].imgSrc[0].imgSrc,_.value=!1,p.value=u.value[0].imgSrc,z(p.value)}),D.value=U.id,(t,o)=>(s(),l(f,null,[g.value?(s(),K(X,{key:0,onClose:o[0]||(o[0]=e=>g.value=!1)},{default:I(()=>[a("p",null,h(m.value),1)]),_:1})):n("",!0),a("div",Y,[P(N,{name:"fade"},{default:I(()=>[_.value?(s(),l("div",Z,te)):n("",!0)]),_:1}),P(N,{name:"fade"},{default:I(()=>[_.value?n("",!0):(s(),l("div",oe,[a("div",ae,[_.value?n("",!0):(s(),l("div",se,[a("div",le,[a("img",{src:`${L(v).apiUrl}/${S.value}`},null,8,re)]),a("div",ce,[(s(!0),l(f,null,k(p.value,e=>(s(),l("div",{key:e.imgSrc,class:"smallPic",onClick:y=>M(e)},[a("img",{src:`${L(v).apiUrl}/${e.imgSrc}`},null,8,ne)],8,ie))),128))])]))]),a("div",ue,[_.value?(s(),l("div",de)):n("",!0),_.value?n("",!0):(s(),l("div",ve,[a("div",_e,[a("div",pe,h(r.value.productName),1),a("div",ge,"$"+h(r.value.price),1)]),a("div",he,[me,a("div",ye,[(s(!0),l(f,null,k(u.value,e=>(s(),l("div",{key:e.style,class:B(["color",{active:e.style===r.value.style}]),onClick:y=>A(e.style,e)},[a("img",{src:` ${L(v).apiUrl}/${e.imgSrc[0].imgSrc}`},null,8,Se)],10,fe))),128))])]),a("div",ke,[De,a("div",Ce,[(s(!0),l(f,null,k(r.value.inventory,e=>(s(),l("div",{key:e.productSizeID,class:B(["size","smallButton",{outOfStock:e.inventory===0,active:e===c.value}]),onClick:y=>T(e)},h(e.productSize),11,Ie))),128))])]),c.value?(s(),l("div",Le,[$e,a("div",we,[Q(a("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e)},[(s(!0),l(f,null,k(G.value,e=>(s(),l("option",{key:e},h(e),1))),128))],512),[[R,d.value]])])])):n("",!0),d.value>0&&c.value!==null?(s(),l("div",ze,[w.value?(s(),l("button",{key:0,class:"add",onClick:V},"加入收藏")):n("",!0),a("button",{class:"add",onClick:J},"加入購物車")])):n("",!0),a("div",Pe,h(r.value.remark),1)]))])]))]),_:1})])],64))}};export{be as default};
