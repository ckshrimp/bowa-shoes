import{_ as nt,i as it,h as ut,r as v,x as j,G as T,y as vt,z as dt,o as pt,q as H,b as u,c as d,k as Q,w as $,A as R,d as s,l as K,T as ht,F as w,t as p,H as _t,e as N,u as ft,v as W,B as X,C as Y,p as Ct,g as gt}from"./index-bb11416d.js";import{u as yt}from"./store-f4a3a2de.js";import{M as Dt}from"./Modal-721e8b5c.js";import{L as mt}from"./Loading-414674df.js";/* empty css                                                              */const b=D=>(Ct("data-v-58b331b3"),D=D(),gt(),D),Lt={id:"shopCart-container"},St={key:1,id:"shopCart-all"},wt=b(()=>s("div",{id:"shopCart-title"},"購物車",-1)),bt={id:"shopCart-main"},It={id:"shopCartFrame"},kt={key:0,id:"shopCart-noList"},Pt=["onClick"],zt=["onClick"],qt=["src"],Tt={class:"shopCart-productDetail"},$t=["onClick"],Nt={class:"shopCart-gender"},Vt={class:"shopCart-select"},Mt=["onUpdate:modelValue","onChange"],Ut=["value"],At=["onUpdate:modelValue","onChange"],Bt=["value"],Ft={class:"shopCart-price"},Jt={id:"shopCart-priceFrame"},Ot={id:"shopCart-box"},Et=b(()=>s("div",{id:"shopCart-little"},"小計",-1)),Gt={class:"shopCart-priceLeft"},jt=b(()=>s("div",{id:"shopCart-discount"},"折扣",-1)),Ht={class:"shopCart-priceLeft"},Qt=b(()=>s("div",{id:"shopCart-total"},"總計(不含運費)",-1)),Rt={class:"shopCart-priceLeft"},Kt={__name:"ShopCart",setup(D){const I=it("config"),k=yt(),V=ut(),m=v(!1),P=v(""),r=v({cartList:[]}),l=v({cartData:[]}),L=v(0),h=j(()=>et()),_=v("無折扣"),M=j(()=>ot()),C=T(new Array(l.value.cartData.length).fill(null)),n=T(new Array(l.value.cartData.length).fill(null)),g=T(new Array(l.value.cartData.length).fill([])),U=v(!1),A=v(!0),z=v(!0),B=v(!1),F=async()=>{const t=k.cartData;let a=JSON.parse(JSON.stringify(t));return console.log("%c vue拿到本地資料","color: yellow; font-weight: bold",a),a},y=async t=>{try{k.updateCartData(t),console.log("%c 已更新本地購物車資料","color: white; font-weight: bold",await F())}catch{console.log("更新本地資料失敗")}},Z=async t=>{try{k.updatePriceData(t)}catch{console.log("更新本地資料失敗")}};function J(t,a){const e=l.value.cartData[t],c=C[t],o=e.inventory.find(f=>f.productSize===c);if(o){const f=o.inventory;g[t]=new Array(f).fill().map((S,i)=>i+1),a||(n[t]=1)}else g[t]=[],n[t]=null}const x=async t=>{const a=l.value.cartData[t],e=C[t],c=n[t],o=a.inventory.find(i=>i.productSize===e).productSizeID,f=r.value.cartList.findIndex(i=>i.productSizeID===o),S=a.inventory.find(i=>i.productSizeID===o).inventory;if(f!==-1){const i=r.value.cartList[f],q=i.quantity+c;q<=S?(i.quantity=q,n[f]=q):(i.quantity=S,n[f]=S),r.value.cartList.splice(t,1),C.splice(t,1),n.splice(t,1),g.splice(t,1),l.value.cartData=r.value.cartList.map(E=>{const G=l.value.cartData.find(rt=>rt.productSizeID===E.productSizeID);return console.log(G,"搜尋到的資料更改=-=-=-=-=-=-="),{...G,quantity:E.quantity}})}else J(t,!1),r.value.cartList.splice(t,1,{productSizeID:o,quantity:c,productSize:e}),l.value.cartData[t].productSizeID=o,l.value.cartData[t].quantity=c,l.value.cartData[t].productSize=e,await y(r.value.cartList)},tt=async(t,a)=>{r.value.cartList[t].quantity=a;const e=l.value.cartData[t];e.quantity=a,await y(r.value.cartList)};function O(t){V.push({name:"Product",params:{id:t},props:{id:t}})}function at(t){const a=l.value.cartData[t],e=n[t];return a.price*e}function et(){return l.value.cartData.reduce((t,a,e)=>{const c=n[e];return t+a.price*c},0)}function ot(){if(h.value>=1e4&&L.value===0&&(_.value="9折"),L.value===1&&(_.value="8折"),h.value<1e4&&L.value===0&&(_.value="無折扣"),_.value==="無折扣")return h.value;if(_.value==="9折")return h.value*.9;if(_.value==="8折")return h.value*.8}const st=async t=>{r.value.cartList.splice(t,1),l.value.cartData.splice(t,1),C.splice(t,1),n.splice(t,1),g.splice(t,1),y(r.value.cartList),U.value===!0&&await H(r.value,`${I.apiUrl}/updateCart`)},ct=async()=>{let t={subTotal:h.value,discount:_.value,totalPrice:M.value};Z(t),y(r.value.cartList),V.push("/shopCartNext")},lt=async()=>{if(h.value!==0)return ct();P.value="購物車沒有商品",m.value=!0,console.log("購物車沒有商品")};return vt(async()=>{dt().then(t=>{let a=t.isLogin;U.value=a,console.log("%c 登入狀況::","color: red; font-weight: bold",a)}).catch(t=>{console.log("重新讀取")})}),pt(async()=>{let t=await F();const a=await H({cartList:t.cartList},`${I.apiUrl}/cart`);l.value={cartData:a.cartData},r.value={cartList:a.cartList},a.level&&(L.value=a.level),console.log("%c cartData::ref已寫入","color: green; font-weight: bold",l.value),console.log("%c cartList::ref已寫入","color: green; font-weight: bold",r.value),console.log("%c memberLevel::ref已寫入","color: green; font-weight: bold",a.level),await y(r.value.cartList),l.value.cartData.forEach((e,c)=>{C[c]=e.inventory[0].productSize,n[c]=e.quantity>e.inventory[0].inventory?e.inventory[0].inventory:e.quantity,J(c,!0),l.value.cartData.length===0?z.value=!0:z.value=!1,B.value=a.cartData.some(o=>o.inventoryShortage),B.value&&(P.value="有部分商品缺貨 購物車商品已更改",m.value=!0)}),setTimeout(()=>{A.value=!1},1e3)}),(t,a)=>(u(),d(w,null,[m.value?(u(),Q(Dt,{key:0,onClose:a[0]||(a[0]=e=>m.value=!1)},{default:$(()=>[s("p",null,p(P.value),1)]),_:1})):R("",!0),s("div",Lt,[K(ht,{name:"fade",mode:"out-in"},{default:$(()=>[A.value===!0?(u(),Q(mt,{key:0})):(u(),d("div",St,[wt,s("div",bt,[s("div",It,[z.value===!0?(u(),d("div",kt," 尚無商品")):R("",!0),K(_t,{name:"list",tag:"ul"},{default:$(()=>[(u(!0),d(w,null,N(l.value.cartData,(e,c)=>(u(),d("div",{key:c,class:"shopCart-product"},[s("div",{class:"shopCart-delete",onClick:o=>st(c)},"x",8,Pt),s("div",{onClick:o=>O(e.productID),class:"shopCart-productPic"},[s("img",{src:`${ft(I).picUrl}/`+e.imgSrc},null,8,qt)],8,zt),s("div",Tt,[s("div",{onClick:o=>O(e.productID),class:"shopCart-productName"},p(e.productName),9,$t),s("div",Nt,p(e.genderType),1),s("div",Vt,[W(" 尺寸 "),X(s("select",{class:"shopCart-size","onUpdate:modelValue":o=>C[c]=o,onChange:o=>x(c)},[(u(!0),d(w,null,N(e.inventory,o=>(u(),d("option",{key:o.productSizeID,value:o.productSize},p(o.productSize),9,Ut))),128))],40,Mt),[[Y,C[c]]]),W(" 數量 "),X(s("select",{class:"shopCart-count","onUpdate:modelValue":o=>n[c]=o,onChange:o=>tt(c,n[c])},[(u(!0),d(w,null,N(g[c],o=>(u(),d("option",{key:o,value:o},p(o),9,Bt))),128))],40,At),[[Y,n[c]]])])]),s("div",Ft,p(at(c))+"$",1)]))),128))]),_:1})]),s("div",Jt,[s("div",Ot,[Et,s("div",Gt,p(h.value),1),jt,s("div",Ht,p(_.value),1),Qt,s("div",Rt,p(M.value),1)]),s("button",{id:"shopCart-next",onClick:a[1]||(a[1]=e=>lt())},"下一步")])])]))]),_:1})])],64))}},ta=nt(Kt,[["__scopeId","data-v-58b331b3"]]);export{ta as default};
